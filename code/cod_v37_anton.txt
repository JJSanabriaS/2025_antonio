#nova version

%pip install -q selenium
%pip install -q tabulate
%pip install pyperclip
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.chrome.options import Options
from PIL import Image
from IPython.display import display
from google.colab import files
import requests
from selenium.webdriver.support.ui import Select
from tabulate import tabulate
import pandas as pd
import pyperclip

# Configure Chrome options for headless mode
chrome_options = Options()
chrome_options.add_argument("--headless")
chrome_options.add_argument("--no-sandbox")
chrome_options.add_argument("--disable-dev-shm-usage")
# options = Options()
#chrome_options.add_argument("prefs", {
#        "profile.content_settings.exceptions.clipboard": {
#            "[*.]": {"setting": 1} # Allow clipboard read for all origins
#        }
#    })
# Initialize the WebDriver (e.g., Chrome) with the configured options
driver = webdriver.Chrome(options=chrome_options)
#wait = WebDriverWait(driver, timeout=2)
#wait.until(lambda _ : revealed.is_displayed())



# Navigate to the webpage containing the div-based table
url="https://opcoes.net.br/opcoes/bovespa/PETR4"
driver.get(url) # Replace with the actual URL
response = requests.get(url)
text_content = response.text
# Wait for the table element to be present (adjust locator as needed)
# This assumes the main table div has a specific class, e.g., 'table-container'
url_list = url.split('/')
print("papel:  "+url_list[len(url_list)-1])
print("\n")
table=driver.find_element(By.ID,"divMinMax")
print("valores maximos")
print(table.text)
print("\n")
print("+++++++++++++++++++++++++++++++++++++++++++++++++++++++")
table2=driver.find_element(By.ID,"divCotacaoAtual")
print("cotacao atual")
print(table2.text)
cotiz = table2.text
cotiz_list = cotiz.split(' ')
print(cotiz_list)
val_mom=cotiz_list[1]
val_mom=float(val_mom.replace(",","."))
print("val no momento  ",val_mom)
print("\n")
print("+++++++++++++++++++++++++++++++++++++++++++++++++++++++")
vencimentos = driver.find_element(By.ID, "grade-vencimentos-dates")
print("grade tipo")
print(vencimentos.text)
ids = driver.find_elements(By.TAG_NAME,"input")
vencimentos=[]
datas=[]
for ii in ids:
    #print ii.tag_name
    #print (ii.get_attribute('id'))    # id name as string
    datas.append(ii.get_attribute('id'))
    vencimentos.append(ii.get_attribute('selected'))

print(datas[0:3])
print(vencimentos[0:3])
print(datas[3:])
print(vencimentos[3:])
print("\n")
table2=driver.find_element(By.ID,"strike-range")
print("range strike")
print(table2.text)
print("+++++++++++++++++++++++++++++++++++++++++++++++++++++++")
print("\n")
print("tabla entera busca titulos")
# Wait for the table to be loaded
#wait = WebDriverWait(driver, 10)


#<button class="dt-button buttons-copy buttons-html5" tabindex="0" aria-controls="tblListaOpc" #type="button"><span>Copiar tabela</span></button>
#button = driver.find_element(By.XPATH, '//button[text()="tabela"]')
#button = driver.find_element(By.CLASS_NAME, "dt-button buttons-copy buttons-html5")
button_element = wait.until(EC.element_to_be_clickable((By.XPATH,("//*[contains(text(), 'Copiar tabela')]"))))
buttons = driver.find_elements(By.XPATH,("//*[contains(text(), 'Copiar tabela')]"))
#ExpectedCondition.ToBeClickable()
print(buttons)
print(button_element)
button_element.click()
#buttons.click()
clipboard_content = driver.execute_script("return navigator.clipboard.readText()")
print(clipboard_content)
#clipboard_text = pyperclip.paste()

# Print the retrieved text
print(tabulate(clipboard_text, headers=headers, tablefmt="grid"))
